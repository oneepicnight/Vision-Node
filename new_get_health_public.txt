pub async fn get_health_public() -> Json<HealthPublicResponse> {
    use crate::mood;
    
    // If in Guardian mode, try to fetch from upstream first
    let guardian_mode = GUARDIAN_MODE.load(std::sync::atomic::Ordering::Relaxed);
    if guardian_mode {
        if let Some(upstream_health) = upstream::upstream_health_public().await {
            return Json(upstream_health);
        }
    }

    // Gather real metrics from chain
    let chain = CHAIN.lock();
    let height = chain.best_height();
    let peer_count = chain.peers.len();
    let mempool_size = chain.mempool_critical.len() + chain.mempool_bulk.len();
    
    // Get testnet phase if applicable
    let testnet_phase = if chain.testnet_48h_checkpoint.is_some() {
        let checkpoint_time = chain.testnet_48h_checkpoint.unwrap_or(0);
        let now = std::time::SystemTime::now()
            .duration_since(std::time::UNIX_EPOCH)
            .unwrap_or_default()
            .as_secs();
        let elapsed_hours = (now.saturating_sub(checkpoint_time)) / 3600;
        
        if elapsed_hours < 24 {
            Some("mining".to_string())
        } else if elapsed_hours < 48 {
            Some("hybrid".to_string())
        } else {
            Some("staking-only".to_string())
        }
    } else {
        None
    };
    
    drop(chain);
    
    // Get health summaries
    let (pending_anomalies, recent_traumas) = get_health_summaries();
    
    // Compute mood using the mood engine
    let snapshot = mood::compute_mood(
        height as u64,
        peer_count,
        mempool_size,
        pending_anomalies,
        recent_traumas,
        guardian_mode,
        testnet_phase,
    );
    
    let chaos_intensity = 1.0 - snapshot.score;
    
    Json(HealthPublicResponse {
        network_mood: format!("{:?}", snapshot.mood).to_lowercase(),
        mood_score: snapshot.score,
        chaos_intensity,
        peer_count,
        anomalies_last_24h: pending_anomalies,
        traumas_last_24h: recent_traumas,
        details: snapshot.details,
    })
}
